<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Usagi RPG Complet</title>
<script src="https://alex84010.github.io/usagi-js.github.io/usagi.js"></script>
<style>
body {margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; image-rendering:pixelated; font-family:monospace;}
#game {position: relative;}
button {font-size:14px;padding:6px 10px;cursor:pointer;}
</style>
</head>
<body>
<div id="game"></div>
<script type="text/usagi">

// ==========================
// âš™ï¸ CONFIG USAGI
// ==========================
Usagi.tileSize = 32;
Usagi.mount("#game");

// ==========================
// ğŸ–¼ï¸ CHARGEMENT DES SPRITES
// ==========================
const assets = [
  "grass","tall_grass","water","wall","floor",
  "player","npc","npc_nurse",
  "monstre1_front","monstre1_back","monstre2_front","monstre2_back",
  "monstre3_front","monstre3_back","monstre4_front","monstre4_back",
  "pokeball","potion"
];

for (let a of assets) await Usagi.loadSprite(a,a+".png");

// ==========================
// ğŸ—ºï¸ CREATION MAP
// ==========================
const map = Usagi.createMap("map1",20,15,"grass");
// Murs
Usagi.fillArea("map1",0,0,20,1,"wall",true);
Usagi.fillArea("map1",0,14,20,1,"wall",true);
Usagi.fillArea("map1",0,0,1,15,"wall",true);
Usagi.fillArea("map1",19,0,1,15,"wall",true);
// Eau
Usagi.fillArea("map1",2,2,4,3,"water",true);
// Herbes
Usagi.fillArea("map1",10,5,5,4,"tall_grass",false);

// ==========================
// ğŸ§ JOUEUR
// ==========================
Usagi.player.sprite="player";
Usagi.player.x=3;
Usagi.player.y=7;
Usagi.currentMap="map1";
Usagi.player.team=[]; // vide au dÃ©but
Usagi.player.items={"pokeball":3,"potion":2};
Usagi.player.money=3000;

// ==========================
// ğŸ² MONSTRES ET STATS
// ==========================
function createMonster(name,level){
  const data = {
    Monstre1:{hp:120,atk:50,def:50,type:"nature"},
    Monstre2:{hp:100,atk:65,def:40,type:"fire"},
    Monstre3:{hp:140,atk:45,def:70,type:"rock"},
    Monstre4:{hp:90,atk:75,def:35,type:"electric"}
  }[name];
  return {
    name,
    level,
    hp:data.hp,
    maxHp:data.hp,
    atk:data.atk,
    def:data.def,
    type:data.type,
    exp:0,
    attacks:["Attaque Basique"]
  };
}

// ==========================
// ğŸŒ¿ COMBATS SAUVAGES
// ==========================
Usagi.addWildArea("map1",10,5,5,4,["Monstre1","Monstre2","Monstre3","Monstre4"],0.2);

// ==========================
// â­ PNJ CHOIX STARTER
// ==========================
Usagi.addNPC("map1",5,6,"npc",["Bonjour! Choisis ton starter."],()=>{
  if(Usagi.player.team.length===0) showStarterMenu();
});

// ==========================
// ğŸ¥ CENTRE DE SOIN
// ==========================
Usagi.addNPC("map1",15,6,"npc_nurse","Soigne ton Ã©quipe.",()=>Usagi.healTeam());

// ==========================
// ğŸ“‹ MENU STARTER
// ==========================
function showStarterMenu(){
  Usagi.ui.innerHTML=`<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border:4px solid #000;padding:16px;text-align:center;pointer-events:all;">
  <h3>Choisis ton starter</h3>
  <button onclick="pickStarter('Monstre1')">Monstre1 ğŸŒ±</button><br><br>
  <button onclick="pickStarter('Monstre2')">Monstre2 ğŸ”¥</button><br><br>
  <button onclick="pickStarter('Monstre3')">Monstre3 ğŸª¨</button>
  </div>`;
  Usagi.showingMenu=true;
}

window.pickStarter=function(name){
  Usagi.player.team=[createMonster(name,5)];
  Usagi.ui.innerHTML="";
  Usagi.showingMenu=false;
  Usagi.showDialogue(name+" rejoint ton Ã©quipe !");
};

// ==========================
// ğŸ—¡ï¸ COMBAT SIMPLE
// ==========================
Usagi.startBattle=function(monsterName,isWild=true){
  this.inBattle=true;
  const enemy=createMonster(monsterName,5);
  const playerPokemon=this.player.team[0];
  this.battleData={isWild,playerPokemon,enemy,turn:"player",canCapture:isWild};
  this.showBattleScreen();
};

Usagi.showBattleScreen=function(){
  const p=this.battleData.playerPokemon;
  const e=this.battleData.enemyPokemon;
  this.ui.innerHTML=`
  <div style="width:100%;height:100%;position:absolute;background:linear-gradient(to bottom,#87CEEB 0%,#98D8C8 100%);pointer-events:all;">
    <div style="position:absolute;top:20%;right:15%;text-align:center;">
      <div style="font-size:18px;font-weight:bold;color:#333;text-shadow:1px 1px 2px white;">${e.name} Nv.${e.level}</div>
      <div style="background:#333;width:150px;height:12px;border:2px solid white;margin:10px auto;border-radius:6px;overflow:hidden;">
        <div style="background:linear-gradient(to right,#4CAF50,#8BC34A);height:100%;width:${e.hp/e.maxHp*100}%;transition:width 0.3s;"></div>
      </div>
      <div style="color:#333;font-size:12px;text-shadow:1px 1px 1px white;">${e.hp}/${e.maxHp} PV</div>
      <div style="font-size:60px;margin-top:10px;">ğŸ²</div>
    </div>
    <div style="position:absolute;bottom:35%;left:15%;text-align:center;">
      <div style="font-size:18px;font-weight:bold;color:#333;text-shadow:1px 1px 2px white;">${p.name} Nv.${p.level}</div>
      <div style="background:#333;width:150px;height:12px;border:2px solid white;margin:10px auto;border-radius:6px;overflow:hidden;">
        <div style="background:linear-gradient(to right,#4CAF50,#8BC34A);height:100%;width:${p.hp/p.maxHp*100}%;transition:width 0.3s;"></div>
      </div>
      <div style="color:#333;font-size:12px;text-shadow:1px 1px 1px white;">${p.hp}/${p.maxHp} PV</div>
      <div style="font-size:60px;margin-top:10px;">âš¡</div>
    </div>
    <div style="position:absolute;bottom:0;left:0;right:0;background:white;border-top:4px solid #333;padding:20px;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
        <button onclick="Usagi.battleAttack()">âš”ï¸ ATTAQUER</button>
        <button onclick="Usagi.battleCapture()">ğŸ¯ CAPTURER</button>
        <button onclick="Usagi.battleItem()">ğŸ’ OBJET</button>
        <button onclick="Usagi.battleFlee()">ğŸƒ FUIR</button>
      </div>
    </div>
  </div>`;
};

// ==========================
// âš”ï¸ ACTIONS BATAILLE
// ==========================
Usagi.battleAttack=function(){
  const p=this.battleData.playerPokemon;
  const e=this.battleData.enemyPokemon;
  const damage=Math.max(1,Math.floor((p.atk*40/e.def)*(0.85+Math.random()*0.15)));
  e.hp=Math.max(0,e.hp-damage);
  if(e.hp<=0){return this.endBattle(true);}
  setTimeout(()=>{
    const enemyDamage=Math.max(1,Math.floor((e.atk*40/p.def)*(0.85+Math.random()*0.15)));
    p.hp=Math.max(0,p.hp-enemyDamage);
    if(p.hp<=0){this.endBattle(false);}
    else{this.showBattleScreen();}
  },800);
  this.showBattleScreen();
};

Usagi.battleCapture=function(){
  const e=this.battleData.enemyPokemon;
  if(Usagi.player.items["pokeball"]<=0){this.showDialogue("Pas de PokÃ©ball !"); return;}
  Usagi.player.items["pokeball"]--;
  const rate=(1-e.hp/e.maxHp)*0.7+0.1;
  if(Math.random()<rate){
    Usagi.player.team.push({...e,hp:e.maxHp});
    this.showDialogue(e.name+" a Ã©tÃ© capturÃ© ! ğŸ‰");
    setTimeout(()=>this.endBattle(true),1500);
  }else{
    this.showDialogue(e.name+" s'est Ã©chappÃ© !");
    setTimeout(()=>{this.closeDialogue(); this.showBattleScreen();},1500);
  }
};

Usagi.battleItem=function(){
  this.showDialogue("Pas d'objet utilisable !");
  setTimeout(()=>{this.closeDialogue(); this.showBattleScreen();},1000);
};

Usagi.battleFlee=function(){
  this.showDialogue("Tu as fui le combat !");
  setTimeout(()=>this.endBattle(false),1000);
};

Usagi.endBattle=function(victoire){
  if(victoire){ 
    const p=this.player.team[0];
    p.exp+=10;
    if(p.exp>=20){p.level++;p.exp=0;p.maxHp+=10;p.atk+=5;p.def+=5;p.hp=p.maxHp;}
  }
  setTimeout(()=>{this.inBattle=false;this.closeDialogue();},1000);
};

  </script>
</body>
</html>

